# 更新日志

## v0.2.5

- **新增**:
    - **标记 (Marker)**:
        - **节点**: 新增“标记”节点，用于标注。
        - **编辑**: 支持点击文本直接进入编辑模式，Enter确定、ESC取消。
        - **Ctrl+P**: 
            - 标记点搜索
            - 输入内容自动匹配对应的标记
            - 按下 ENTER 自动将视角移向对应标记
    - **编辑器小地图**: 在编辑器右下角新增小地图功能，直观展示全图结构及当前视野范围。
        - 在编辑器中按下 `M` 键可快速显示或隐藏小地图。
- **优化**:
    - **连线渲染**: 根据连线长度与缩放级别动态计算分段数


## v0.2.4

- **新增**: 
    - `XYZ` 数据类型，专门用于存储三维空间坐标 (x, y, z)。
    - `ENTITY` 数据类型，支持更直接、类型安全的实体对象操作。
    - 新增“浮点数到XYZ”与“XYZ到浮点数”转换节点。
    - **更多实体动作**: 新增“杀死实体”、“伤害实体”、“治疗实体”、“设置实体着火”、“设置实体速度”、“添加药水效果”、“清除所有药水效果”等节点。
    - **实体信息获取**: 新增“通过实体获取实体信息”节点，支持直接从实体对象提取数据，无需经过 UUID。
    - **连线管理**: 支持在蓝图编辑器中右键点击单条连线进行断开。
- **重构**: 
    - 蓝图数据格式版本从 `4` 升级至 `5`。
    - 移除了所有节点中分散的 `X` / `Y` / `Z` 浮点数端口，统一替换为单个 `XYZ` 类型的端口。
    - **实体引用现代化**: 将大量节点中原有的 `UUID` 字符串端口替换为 `ENTITY` 对象端口，提升了执行效率和开发体验。
    - **兼容性增强**: 增强了 `BlueprintEngine` 对旧版 UUID 数据的自动解析能力，确保 `/mgrun` 等通过 UUID 触发的命令依然能够自动匹配到实体对象。
    - **注意**: 以上变更会导致旧版蓝图（v4及以下）中的部分端口连接失效，建议重新连接。
    - 受影响的节点包括：“当运行 mgrun 命令时”、“当破坏方块时”、“当放置方块时”、“当点击方块时”、“当玩家移动时”、“当玩家死亡时”、“当玩家复活时”、“播放粒子效果”、“爆炸”、“获取实体信息”以及所有涉及实体的动作节点。
- **优化**: 
    - `TypeConverter` 现在支持 `XYZ` 和 `Entity` 类型与字符串/对象之间的智能转换。
    - `NodeContext` 现在自动为所有事件提供 `triggerXYZ` 和 `triggerEntity` 数据，极大简化了节点逻辑编写。

## v0.2.3

- **新增**: 撤销 (Undo) 和 重做 (Redo) 功能。
    - 支持 Ctrl+Z (撤销) 和 Ctrl+Y / Ctrl+Shift+Z (重做)。
    - 支持最多 50 步操作历史，包括节点移动、连线、删除、粘贴、值修改等。
- **修复**: 解决了 EXEC 端口在相同节点间可以重复连线的问题，现在重复连接会自动覆盖旧线段。
- **优化**: 将“获取实体信息”、“以玩家身份运行命令”等节点的 UUID 输入端口类型从 STRING 更改为更直觉的 UUID 类型。
- **适配**: 蓝图搜索系统现已适配 `Just Enough Characters` (JECh) 模组。


## v0.2.2

- 修复了“当玩家移动”节点在静止状态下依然触发的问题
- 搜索框集成 Minecraft 原生 EditBox，支持光标导航、IME 输入及文本选择。
    - 附带兼容 IMBlocker 模组
- 新增低版本蓝图兼容性警告
- **编辑器增强**: 新增框选、多选、复制与粘贴功能
    - 支持通过鼠标拖拽进行区域框选
    - 支持按住 `Shift` 或 `Ctrl` 键进行多选/反选
    - 支持 `Ctrl+C` 复制选中节点及连接，`Ctrl+V` 粘贴
    - 支持选中多个节点后同步拖拽移动


## v0.2.1

- 引入命名空间机制
- 增加重复注册校验
- 引入事件驱动的节点注册机制
- 规范化颜色与分类定义
- 执行期状态污染修复
- 注册表冻结机制
- 移动了mappings.json的存储位置
- 事件多态性支持
- 将节点初始化逻辑移至commonSetup阶段
- 解决全部Warning
- 修复了已知的其他问题
- 优化了蓝图引擎执行效率
- 引入原子化路由更新机制
- 增强蓝图管理器的并发安全性
- 实现全局缓存显式清理机制
- 更改蓝图版本为4

## v0.2.0

- 引入了mapping机制

## v0.1.4

### 核心系统重构 (Major Refactoring)
- **节点注册系统标准化**: 
  - 全面引入 `NodeHelper` 链式调用 API，规范了所有节点的元数据声明与逻辑注册流程。

### 蓝图格式升级
- **蓝图格式版本 (Format 3)**: 提升了蓝图存储格式版本，以兼容重构后的节点注册逻辑及未来更复杂的属性扩展。

## v0.1.3

### 列表系统彻底重构
- **移除伪列表逻辑 (Legacy List Cleanup)**: 
  - 彻底删除了所有基于 `|` 符号拼接的“字符串列表”逻辑。
  - `TypeConverter` 转换引擎现在完全拥抱原生 Java `List` 与 Gson `JsonArray`。
  - `String Split` (字符串分割) 与 `On MgRun` (事件参数) 节点现在直接输出真实的列表对象。

## v0.1.2

### 核心引擎重构
- **彻底去字符串化 (De-stringification)**: 
  - 重构了节点输入输出系统，核心计算流程（数学、逻辑、列表、变量）现在直接使用原生 Java 类型（Double, Boolean, List）进行流转。
  - 显著降低了在高频触发场景下的内存抖动与 CPU 转换开销。
- **蓝图格式版本化 (Format Versioning)**: 
  - 引入 `format_version: 2` 格式，支持原生 JSON 类型存储。
  - 完美向下兼容旧版蓝图，确保老脚本无需修改即可运行。

### 安全与稳定性增强
- **服务端权限校验**: 
  - 增加了对蓝图保存、删除、重命名等敏感操作的服务端 OP 权限（Level 2）校验。
  - 修复了客户端可以绕过编辑器限制直接操作服务端文件的安全漏洞。
- **路径穿越防护**: 对蓝图文件名进行了严格的正则校验，严禁 `..` 或路径分隔符，防止非法文件操作。
- **死循环保护机制**: 
  - 引入了 `max_node_executions` 配置项，限制单个事件触发下的最大节点执行数。
  - 即使编写了逻辑错误的无限循环，也不会导致服务器卡死或崩溃。
- **异步 IO 处理**: 蓝图保存操作现在完全异步化，避免了在大规模蓝图保存时造成的瞬时卡顿。

### 节点优化
- **变量系统**: `Get/Set Variable` 现在支持存储任何类型的对象，不再强制转换为字符串。
- **列表包含节点**: 优化了匹配逻辑，现在支持对数值、布尔值及字符串的智能匹配。

## v0.1.1

### 新特性
- **多人联机支持**: 实现了完整的客户端-服务端同步协议，支持在多人服务器中使用蓝图系统。
- **服务端统一存储**: 联机模式下蓝图现在统一存储在服务端存档目录（`world/mgmc_blueprints`），确保所有玩家同步。
- **版本校验系统**: 引入蓝图版本号机制，防止多人同时编辑同一蓝图时发生竞态冲突导致数据损坏。
